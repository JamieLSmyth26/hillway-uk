Refactor the specified code: $ARGUMENTS

1. Analyze the current implementation
2. Identify issues:
   - Code smells (duplication, long functions, etc.)
   - Complexity that can be simplified
   - Better patterns that could apply
3. Propose refactoring plan (use plan mode)
4. After approval, implement the refactoring
5. Run tests to ensure behavior is preserved
6. Show before/after comparison

Keep the same behavior - this is refactoring, not feature changes.
